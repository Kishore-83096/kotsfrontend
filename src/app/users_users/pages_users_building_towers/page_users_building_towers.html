<article class="towers-page">
  <header class="content-header">
    <div class="header-layout">
      <section class="header-info">
        <h2>{{ selectedBuilding()?.name ?? 'Building' }} Towers</h2>
        <p>Browse tower inventory and availability.</p>
      </section>
      <div class="header-actions-block">
        <div class="header-meta-actions">
          @if (selectedBuilding(); as building) {
            <button type="button" class="view-btn header-inline-btn" (click)="openAmenitiesModal(building)">
              View Amenities
            </button>
          }
          <a class="action-btn ghost header-inline-btn" routerLink="/home" title="Go back to residency">
            Go Back to Residency
          </a>
        </div>
      </div>
    </div>
  </header>

  @if (error()) {
    <section class="state-card error">
      <p>{{ error() }}</p>
    </section>
  }

  @if (towersData().length === 0 && !isLoading() && !error()) {
    <section class="state-card">
      <p>No towers found for this building.</p>
    </section>
  }

  @if (isLoading()) {
    <section class="towers-list">
      @for (item of [1, 2, 3]; track item) {
        <article class="tower-card">
          <div>
            <div class="skeleton-block skeleton-line lg"></div>
          </div>
          <div class="skeleton-block skeleton-image"></div>
          <div>
            <div class="skeleton-block skeleton-line"></div>
            <div class="skeleton-block skeleton-line"></div>
          </div>
        </article>
      }
    </section>
  }

  <section class="towers-list">
    @for (tower of towersData(); track tower.id) {
      <article
        class="tower-card"
        role="button"
        tabindex="0"
        (click)="openTowerDetail(tower.id)"
        (keydown.enter)="openTowerDetail(tower.id)"
        (keydown.space)="openTowerDetail(tower.id); $event.preventDefault()"
        aria-label="Open details for tower {{ tower.name }}"
      >
        <h3 class="tower-title">{{ tower.name }}</h3>

        @if (tower.picture_url) {
          <img class="tower-image" [src]="tower.picture_url" [alt]="tower.name + ' tower picture'" />
        } @else {
          <div class="tower-image-placeholder">No Image</div>
        }

          <div class="tower-content">
          <div class="tower-meta-table">
            <p><span>Tower Name</span><strong>{{ tower.name }}</strong></p>
            <p><span>Floors</span><strong>{{ tower.floors }}</strong></p>
              <p><span>Total Flats</span><strong>{{ tower.total_flats ?? 'N/A' }}</strong></p>
              <p><span>Current Added Flats</span><strong>{{ tower.flats_count ?? 'N/A' }}</strong></p>
              <p><span>Available Flats</span><strong>{{ tower.available_flats_count ?? 'N/A' }}</strong></p>
            </div>
          </div>
        </article>
      }
  </section>
</article>

@if (isAmenitiesModalOpen()) {
  <section class="modal-backdrop" (click)="closeAmenitiesModal()">
    <article class="action-modal amenities-modal" (click)="$event.stopPropagation()">
      <header class="modal-header">
        <h3>{{ selectedAmenitiesBuilding()?.name }} Amenities</h3>
        <button type="button" class="view-btn ghost" (click)="closeAmenitiesModal()">Close</button>
      </header>
      <div class="modal-content">
        @if (isAmenitiesModalLoading()) {
          <div>
            <div class="skeleton-block skeleton-line lg"></div>
            <div class="skeleton-block skeleton-line"></div>
            <div class="skeleton-block skeleton-image"></div>
          </div>
        }

        @if (amenitiesModalError()) {
          <p class="error-text">{{ amenitiesModalError() }}</p>
        }

        @if (!isAmenitiesModalLoading() && !amenitiesModalError() && amenitiesModalData().length === 0) {
          <p class="amenity-desc">No amenities found for this building.</p>
        }

        @if (amenitiesModalData().length > 0) {
          <p class="building-name-line"><strong>Building:</strong> {{ selectedAmenitiesBuilding()?.name ?? 'N/A' }}</p>
          <div class="amenities-list">
            @for (amenity of amenitiesModalData(); track amenity.name + '-' + $index) {
              <article class="amenity-card">
                @if (amenity.picture_url) {
                  <img class="amenity-image" [src]="amenity.picture_url" [alt]="amenity.name + ' image'" />
                } @else {
                  <div class="amenity-image-placeholder">No Image</div>
                }

                <div class="amenity-content">
                  <h4>{{ amenity.name }}</h4>
                  <p class="amenity-description"><strong>Description:</strong> {{ amenity.description ?? 'No description' }}</p>
                </div>
              </article>
            }
          </div>
        }
      </div>
    </article>
  </section>
}
